<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Pizza Vault - Professional Scaler</title>
    <style>
        :root { --primary: #c62828; --secondary: #2e7d32; --dark: #263238; --light: #f4f7f6; }
        body { font-family: -apple-system, system-ui, sans-serif; line-height: 1.5; color: #333; margin: 0; background-color: var(--light); }
        header { background: var(--primary); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }
        
        /* Home Screen Cards */
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .recipe-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s; border: 1px solid #ddd; display: flex; flex-direction: column; }
        .recipe-card:hover { transform: translateY(-5px); }
        .recipe-card-content { padding: 20px; flex-grow: 1; }
        .recipe-card h3 { margin: 0 0 10px 0; color: var(--primary); }
        
        /* Scaling App View */
        .view-hidden { display: none; }
        .btn-back { background: white; color: var(--primary); border: 2px solid white; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .pan-entry { background: #fffde7; padding: 15px; border-radius: 8px; border: 1px solid #ffd54f; margin-bottom: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; align-items: flex-end; }
        label { display: block; font-weight: bold; font-size: 0.9em; margin-bottom: 5px; color: #5d4037; }
        input, select { padding: 10px; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; }
        
        .summary-bar { background: var(--dark); color: white; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 1.1em; flex-wrap: wrap; gap: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .fresh-tag { color: #1565c0; font-size: 0.8em; font-weight: bold; }
        .method-box { background: #fdfdfd; padding: 20px; border-radius: 8px; border-left: 5px solid var(--secondary); white-space: pre-wrap; }
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1>The Pizza Vault</h1>
    <button id="back-btn" class="btn-back hidden" onclick="showHome()">← Home</button>
</header>

<div class="container">
    <div id="home-view">
        <h2>Select a Recipe</h2>
        <div class="recipe-grid" id="recipe-list"></div>
    </div>

    <div id="calc-view" class="view-hidden">
        <div class="card">
            <h2 id="current-recipe-name" style="margin-bottom:5px;">Recipe Name</h2>
            <p id="recipe-description" style="color:#666; margin-bottom:20px;"></p>
            
            <div id="fresh-milled-toggle" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #90caf9;">
                <input type="checkbox" id="isFreshMilled" onchange="calculate()">
                <label for="isFreshMilled" style="display:inline; margin-left: 10px;">Enable Fresh Milled Flour (+5% Liquids)</label>
            </div>

            <div id="pan-container"></div>
            <button onclick="addPan()" style="background:var(--secondary); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:bold;">+ Add Different Pan Size</button>

            <div class="summary-bar" style="margin-top:20px;">
                <div>Scaling Factor: <span id="factor-display" style="color:#ffca28; font-weight:bold;">1.0</span>x</div>
                <div>Total Dough Needed: <span id="grand-total" style="color:#ffca28; font-weight:bold;">0</span>g</div>
            </div>

            <table id="ingredient-table">
                <thead><tr><th>Ingredient</th><th>Phase</th><th>Weight (Grams)</th></tr></thead>
                <tbody id="ingredient-body"></tbody>
            </table>
        </div>

        <div class="card method-box">
            <h3>Instructions</h3>
            <div id="method-text"></div>
        </div>
    </div>
</div>

<script>
    const recipes = [
        {
            id: "melt-detroit",
            name: "Detroit-Style pizza dough",
            desc: "70% Hydration, 40% Poolish. Classic Detroit crust.",
            baseArea: 80, 
            ingredients: [
                { name: "Bread Flour (Poolish)", val: 132, type: "flour", phase: "Poolish" },
                { name: "Water (Poolish)", val: 132, type: "water", phase: "Poolish" },
                { name: "Yeast (Poolish)", val: 0.9, type: "yeast", phase: "Poolish" },
                { name: "Bread Flour (Main)", val: 198, type: "flour", phase: "Main" },
                { name: "Water (Main)", val: 99, type: "water", phase: "Main" },
                { name: "Salt", val: 8.25, type: "salt", phase: "Main" },
                { name: "Sugar", val: 8.25, type: "sugar", phase: "Main" },
                { name: "Olive Oil", val: 8.25, type: "oil", phase: "Main" },
                { name: "Yeast (Main)", val: 1, type: "yeast", phase: "Main" }
            ],
            method: "1. Make Poolish 8-12 hrs before.\n2. Mix Final Dough, add oil last.\n3. Rest in oiled pan 1 hr.\n4. Press to corners, proof 1-2 hrs.\n5. Parbake 450°F (6-8 mins).\n6. Top & Bake 500°F (12-15 mins)."
        },
        {
            id: "dominos-style",
            name: "Dominos Style Hand-Tossed",
            desc: "Hand tossed pizza dough.",
            baseArea: 452.4, 
            ingredients: [
                { name: "Flour", val: 750, type: "flour", phase: "Dough" },
                { name: "Sugar", val: 24, type: "sugar", phase: "Dough" },
                { name: "Instant Yeast", val: 13, type: "yeast", phase: "Dough" },
                { name: "Salt", val: 18, type: "salt", phase: "Dough" },
                { name: "Water (100-110°F)", val: 300, type: "water", phase: "Dough" },
                { name: "Milk (100-110°F)", val: 245, type: "water", phase: "Dough" },
                { name: "Olive Oil", val: 40, type: "oil", phase: "Dough" }
            ],
            method: "1. Mix dry ingredients.\n2. Add warm milk, water, and oil (100-110°F).\n3. Knead until windowpane stage (stretch to see through).\n4. Proof 1 hr until doubled.\n5. Portion & roll out. Add sauce.\n6. Parbake 450°F (4 mins).\n7. COOL fully, then add toppings.\n8. Freeze until solid. To cook: 450°F for 8-10 mins from frozen."
        },
        {
            id: "tavern-style",
            name: "Chicago Tavern Style",
            desc: "Butter-infused thin crust with a cold-fermented.",
            baseArea: 226.2, 
            ingredients: [
                { name: "Bread Flour", val: 450, type: "flour", phase: "Dough" },
                { name: "Cold Butter (bits)", val: 60, type: "oil", phase: "Dough" },
                { name: "Salt", val: 9, type: "salt", phase: "Dough" },
                { name: "Instant Yeast", val: 4, type: "yeast", phase: "Dough" },
                { name: "Ice Water", val: 180, type: "water", phase: "Dough" }
            ],
            method: "1. Food Processor: Pulse flour & cold butter (gravel texture).\n2. Dissolve yeast/salt in water, add to flour. Pulse 20-30s.\n3. Knead 2 mins. Ferment 2 hrs.\n4. Divide, roll thin (12\"), dock with fork.\n5. Refrigerate UNCOVERED 4-24 hrs on cornmeal to develop 'skin'.\n6. Sauce, raw sausage balls, cheese edge-to-edge.\n7. Bake at 550°F for ~10 mins."
        }
    ];

    let currentRecipe = null;
    let pans = [{ id: Date.now(), shape: 'rect', dim1: 10, dim2: 8, qty: 1 }];

    function init() {
        const list = document.getElementById('recipe-list');
        recipes.forEach(r => {
            const card = document.createElement('div');
            card.className = 'recipe-card';
            card.innerHTML = `<div class="recipe-card-content"><h3>${r.name}</h3><p>${r.desc}</p></div>`;
            card.onclick = () => loadRecipe(r.id);
            list.appendChild(card);
        });
    }

    function loadRecipe(id) {
        currentRecipe = recipes.find(r => r.id === id);
        document.getElementById('home-view').classList.add('view-hidden');
        document.getElementById('calc-view').classList.remove('view-hidden');
        document.getElementById('back-btn').classList.remove('hidden');
        document.getElementById('current-recipe-name').innerText = currentRecipe.name;
        document.getElementById('recipe-description').innerText = currentRecipe.desc;
        document.getElementById('method-text').innerText = currentRecipe.method;
        renderPans();
    }

    function showHome() {
        document.getElementById('home-view').classList.remove('view-hidden');
        document.getElementById('calc-view').classList.add('view-hidden');
        document.getElementById('back-btn').classList.add('hidden');
        currentRecipe = null;
    }

    function addPan() {
        pans.push({ id: Date.now(), shape: 'rect', dim1: 10, dim2: 8, qty: 1 });
        renderPans();
    }

    function deletePan(id) {
        if(pans.length > 1) {
            pans = pans.filter(p => p.id !== id);
            renderPans();
        }
    }

    function updatePan(id, field, val) {
        const pan = pans.find(p => p.id === id);
        pan[field] = (field === 'shape') ? val : (parseFloat(val) || 0);
        if(field === 'shape') renderPans();
        else calculate();
    }

    function renderPans() {
        const container = document.getElementById('pan-container');
        container.innerHTML = '';
        pans.forEach(pan => {
            const div = document.createElement('div');
            div.className = 'pan-entry';
            div.innerHTML = `
                <div><label>Shape</label><select onchange="updatePan(${pan.id}, 'shape', this.value)">
                    <option value="rect" ${pan.shape === 'rect' ? 'selected' : ''}>Rectangle</option>
                    <option value="circle" ${pan.shape === 'circle' ? 'selected' : ''}>Circle</option>
                </select></div>
                <div><label>${pan.shape === 'rect' ? 'Length' : 'Diameter'}</label><input type="number" step="0.1" value="${pan.dim1}" oninput="updatePan(${pan.id}, 'dim1', this.value)"></div>
                <div class="${pan.shape === 'circle' ? 'hidden' : ''}"><label>Width</label><input type="number" step="0.1" value="${pan.dim2}" oninput="updatePan(${pan.id}, 'dim2', this.value)"></div>
                <div><label>Quantity</label><input type="number" min="1" value="${pan.qty}" oninput="updatePan(${pan.id}, 'qty', this.value)"></div>
                <button style="background:#d32f2f; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer;" onclick="deletePan(${pan.id})">Remove</button>
            `;
            container.appendChild(div);
        });
        calculate();
    }

    function calculate() {
        if (!currentRecipe) return;
        let totalAreaSum = 0;
        const isFresh = document.getElementById('isFreshMilled').checked;

        pans.forEach(pan => {
            let area = (pan.shape === 'rect') ? (pan.dim1 * pan.dim2) : (Math.PI * Math.pow(pan.dim1/2, 2));
            totalAreaSum += (area * pan.qty);
        });

        let totalFactor = totalAreaSum / currentRecipe.baseArea;
        document.getElementById('factor-display').innerText = totalFactor.toFixed(1);
        
        const tbody = document.getElementById('ingredient-body');
        tbody.innerHTML = "";
        let grandTotal = 0;

        currentRecipe.ingredients.forEach(ing => {
            let amt = ing.val * totalFactor;
            if (isFresh && (ing.type === "water" || ing.name.toLowerCase().includes("milk"))) {
                amt *= 1.05;
            }
            grandTotal += amt;
            tbody.innerHTML += `<tr><td>${ing.name} ${isFresh && (ing.type === "water" || ing.name.toLowerCase().includes("milk")) ? '<span class="fresh-tag">(+5%)</span>' : ''}</td><td>${ing.phase}</td><td><strong>${amt.toFixed(1)}g</strong></td></tr>`;
        });
        document.getElementById('grand-total').innerText = Math.round(grandTotal);
    }

    init();
</script>
</body>
</html>
